/*! HSO D365 CLI 1.8.0 | (c) HSO Innovation */!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=20)}([function(t,e){t.exports=require("fs")},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{s(r.next(t))}catch(t){o(t)}}function u(t){try{s(r.throw(t))}catch(t){o(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,u)}s((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}};Object.defineProperty(e,"__esModule",{value:!0});var o=n(5),a=["eq","ne","gt","ge","lt","le"],u=function(){function t(){}return t.retrieveMultipleRecords=function(e,n,o){return r(this,void 0,void 0,(function(){var r,a,u,s,c,l,f,h;return i(this,(function(i){switch(i.label){case 0:return[4,t.getSystemQueryOptions(e,n,o)];case 1:return r=i.sent(),a=o.settings,u=o.bearer,s=a.crm,c=s.url,l=s.version,[4,t.getEntityDefinition(e,o,["EntitySetName"])];case 2:return f=i.sent().EntitySetName,h=c+"/api/data/v"+l+"/"+f+r,[4,t.request("GET",h,null,{Authorization:"Bearer "+u})];case 3:return[2,i.sent().body.value]}}))}))},t.retrieveRecord=function(e,n,o,a){return r(this,void 0,void 0,(function(){var r,u,s,c,l,f,h,d;return i(this,(function(i){switch(i.label){case 0:return[4,t.getSystemQueryOptions(e,o,a)];case 1:return r=i.sent(),u=a.settings,s=a.bearer,c=u.crm,l=c.url,f=c.version,[4,t.getEntityDefinition(e,a,["EntitySetName"])];case 2:return h=i.sent().EntitySetName,d=l+"/api/data/v"+f+"/"+h+"("+n+")"+r,[4,t.request("GET",d,null,{Authorization:"Bearer "+s})];case 3:return[2,i.sent().body]}}))}))},t.updateRecord=function(e,n,o,a){return r(this,void 0,void 0,(function(){var r,u,s,c,l,f,h;return i(this,(function(i){switch(i.label){case 0:return r=a.settings,u=a.bearer,s=r.crm,c=s.url,l=s.version,[4,t.getEntityDefinition(e,a,["EntitySetName"])];case 1:return f=i.sent().EntitySetName,h=c+"/api/data/v"+l+"/"+f+"("+n+")",[4,t.request("PATCH",h,o,{Authorization:"Bearer "+u,Prefer:"return=representation"})];case 2:return[2,i.sent().body]}}))}))},t.insertRecord=function(e,n,o){return r(this,void 0,void 0,(function(){var r,a,u,s,c,l,f;return i(this,(function(i){switch(i.label){case 0:return r=o.settings,a=o.bearer,u=r.crm,s=u.url,c=u.version,[4,t.getEntityDefinition(e,o,["EntitySetName"])];case 1:return l=i.sent().EntitySetName,f=s+"/api/data/v"+c+"/"+l,[4,t.request("POST",f,n,{Authorization:"Bearer "+a,Prefer:"return=representation"})];case 2:return[2,i.sent().body]}}))}))},t.getStatusOptionSet=function(e,n){return r(this,void 0,void 0,(function(){var r,o,a,u,s,c;return i(this,(function(i){switch(i.label){case 0:return r=n.settings,o=n.bearer,a=r.crm,u=a.url,s=a.version,c=u+"/api/data/v"+s+"/EntityDefinitions(LogicalName='"+e+"')/Attributes/Microsoft.Dynamics.CRM.StatusAttributeMetadata?$expand=OptionSet",[4,t.request("GET",c,null,{Authorization:"Bearer "+o})];case 1:return[2,i.sent().body.value[0].OptionSet.Options.map((function(t){return{value:t.Value,externalValue:t.ExternalValue,label:t.Label.UserLocalizedLabel.Label}}))]}}))}))},t.getStateOptionSet=function(e,n){return r(this,void 0,void 0,(function(){var r,o,a,u,s,c;return i(this,(function(i){switch(i.label){case 0:return r=n.settings,o=n.bearer,a=r.crm,u=a.url,s=a.version,c=u+"/api/data/v"+s+"/EntityDefinitions(LogicalName='"+e+"')/Attributes/Microsoft.Dynamics.CRM.StateAttributeMetadata?$expand=OptionSet",[4,t.request("GET",c,null,{Authorization:"Bearer "+o})];case 1:return[2,i.sent().body.value[0].OptionSet.Options.map((function(t){return{value:t.Value,externalValue:t.ExternalValue,label:t.Label.UserLocalizedLabel.Label}}))]}}))}))},t.getPicklistOptionSet=function(e,n,o){return r(this,void 0,void 0,(function(){var r,a,u,s,c,l;return i(this,(function(i){switch(i.label){case 0:return r=o.settings,a=o.bearer,u=r.crm,s=u.url,c=u.version,l=s+"/api/data/v"+c+"/EntityDefinitions(LogicalName='"+e+"')/Attributes(LogicalName='"+n+"')/Microsoft.Dynamics.CRM.PicklistAttributeMetadata?$select=LogicalName&$expand=OptionSet($select=Options)",[4,t.request("GET",l,null,{Authorization:"Bearer "+a})];case 1:return[2,i.sent().body.OptionSet.Options.map((function(t){return{value:t.Value,externalValue:t.ExternalValue,label:t.Label.UserLocalizedLabel.Label}}))]}}))}))},t.getBooleanOptionSet=function(e,n,o){return r(this,void 0,void 0,(function(){var r,a,u,s,c,l,f,h,d,p;return i(this,(function(i){switch(i.label){case 0:return r=o.settings,a=o.bearer,u=r.crm,s=u.url,c=u.version,l=s+"/api/data/v"+c+"/EntityDefinitions(LogicalName='"+e+"')/Attributes(LogicalName='"+n+"')/Microsoft.Dynamics.CRM.BooleanAttributeMetadata?$select=LogicalName&$expand=OptionSet($select=TrueOption,FalseOption)",[4,t.request("GET",l,null,{Authorization:"Bearer "+a})];case 1:return f=i.sent().body,h=f.OptionSet,d=h.FalseOption,p=h.TrueOption,[2,[{value:d.Value,label:d.Label.UserLocalizedLabel.Label},{value:p.Value,label:p.Label.UserLocalizedLabel.Label}]]}}))}))},t.executeAction=function(t,e,n,o,a){return r(this,void 0,void 0,(function(){return i(this,(function(r){return o?[2,this.executeBoundAction(t,e,n,o,a)]:[2,this.executeUnboundAction(t,e,n)]}))}))},t.executeBoundAction=function(e,n,o,a,u){return r(this,void 0,void 0,(function(){var r,s,c,l,f,h,d;return i(this,(function(i){switch(i.label){case 0:return[4,Xrm.Utility.getEntityMetadata(a)];case 1:return r=i.sent(),s=n.settings,c=n.bearer,l=s.crm,f=l.url,h=l.version,d=f+"/api/data/v"+h+"/"+r.EntitySetName+"("+u+")/Microsoft.Dynamics.CRM."+e,[4,t.request("POST",d,o,{Authorization:"Bearer "+c})];case 2:return[2,i.sent().body]}}))}))},t.executeUnboundAction=function(e,n,o){return r(this,void 0,void 0,(function(){var r,a,u,s,c,l,f;return i(this,(function(i){switch(i.label){case 0:return r=o?"POST":"GET",a=n.settings,u=n.bearer,s=a.crm,c=s.url,l=s.version,f=c+"/api/data/v"+l+"/"+e,[4,t.request(r,f,o,{Authorization:"Bearer "+u})];case 1:return[2,i.sent().body]}}))}))},t.getSystemQueryOptions=function(e,n,o){return r(this,void 0,void 0,(function(){var r,a,u,s,c,l,f,h,d,p,v;return i(this,(function(i){switch(i.label){case 0:return r=n.select,a=n.filters,u=n.expands,s=n.orders,c=n.top,[4,t.generateSelect(r,e,o)];case 1:return l=i.sent(),[4,t.generateFilter(a,e,o)];case 2:return f=i.sent(),[4,t.generateExpand(u,e,o)];case 3:return h=i.sent(),[4,t.generateOrderby(s,e,o)];case 4:return d=i.sent(),p=c?"$top="+c:null,v=[],l&&v.push(l),f&&v.push(f),h&&v.push(h),d&&v.push(d),p&&v.push(p),[2,v.length>0?"?"+v.join("&"):""]}}))}))},t.generateSelect=function(e,n,o){return void 0===e&&(e=[]),r(this,void 0,void 0,(function(){var r,a,u,s,c,l;return i(this,(function(i){switch(i.label){case 0:if(r=[],!(e.length>0))return[3,4];a=0,u=e,i.label=1;case 1:return a<u.length?(s=u[a],l=(c=r).push,[4,t.getOptionsName(s,n,o)]):[3,4];case 2:l.apply(c,[i.sent()]),i.label=3;case 3:return a++,[3,1];case 4:return[2,r.length>0?"$select="+r.join(","):null]}}))}))},t.generateFilter=function(e,n,o){return void 0===e&&(e=[]),r(this,void 0,void 0,(function(){var r,a,u,s,c,l;return i(this,(function(i){switch(i.label){case 0:if(r=[],!(e.length>0))return[3,4];a=0,u=e,i.label=1;case 1:return a<u.length?(s=u[a],l=(c=r).push,[4,t.parseFilter(s,n,o)]):[3,4];case 2:l.apply(c,[i.sent()]),i.label=3;case 3:return a++,[3,1];case 4:return[2,r.length>0?"$filter="+r.join(" and "):null]}}))}))},t.parseFilter=function(e,n,o){return r(this,void 0,void 0,(function(){var r,u,s,c,l,f,h,d,p,v,b,y,g,m,w,S,x,O,A,E;return i(this,(function(i){switch(i.label){case 0:r=e.type,u=void 0===r?"and":r,s=e.conditions,c=e.filters,l=void 0===c?[]:c,f=[],h=0,d=s,i.label=1;case 1:return h<d.length?(p=d[h],v=p.operator,b=void 0===v?"eq":v,a.includes(b)?(g=(y=f).push,[4,t.parseFilterCondition(p,n,o)]):[3,3]):[3,6];case 2:return g.apply(y,[i.sent()]),[3,5];case 3:return w=(m=f).push,[4,t.parseQueryFunction(p,n,o)];case 4:w.apply(m,[i.sent()]),i.label=5;case 5:return h++,[3,1];case 6:S=0,x=l,i.label=7;case 7:return S<x.length?(O=x[S],E=(A=f).push,[4,t.parseFilter(O,n,o)]):[3,10];case 8:E.apply(A,[i.sent()]),i.label=9;case 9:return S++,[3,7];case 10:return[2,"("+f.join(" "+u+" ")+")"]}}))}))},t.parseFilterCondition=function(e,n,o){return r(this,void 0,void 0,(function(){var r,a,u,s,c,l,f,h;return i(this,(function(i){switch(i.label){case 0:return r=e.attribute,a=e.operator,u=void 0===a?"eq":a,s=e.value,[4,t.getAttributeMetadata(r,n,o)];case 1:return c=i.sent(),l=c.AttributeType,[4,t.getOptionsName(r,n,o)];case 2:return f=i.sent(),h=["String","EntityName"].includes(l)?"'"+s+"'":""+s,[2,f+" "+u+" "+h]}}))}))},t.parseQueryFunction=function(e,n,o){return r(this,void 0,void 0,(function(){var r,a,u,s,c,l,f;return i(this,(function(i){switch(i.label){case 0:return r=e.attribute,a=e.operator,u=void 0===a?"eq":a,s=e.value,[4,t.getOptionsName(r,n,o)];case 1:return c=i.sent(),l="Microsoft.Dynamics.CRM."+u+"(PropertyName='"+c+"'",void 0!==s&&(Array.isArray(s)?(f=s.map((function(t){return"'"+t+"'"})),l+=",PropertyValues=["+f.join(",")+"]"):l+=",PropertyValue='"+s+"'"),[2,l+=")"]}}))}))},t.generateExpand=function(e,n,o){return void 0===e&&(e=[]),r(this,void 0,void 0,(function(){var r,a,u,s,c,l,f,h,d,p,v,b,y,g;return i(this,(function(i){switch(i.label){case 0:if(r=[],!(e.length>0))return[3,9];a=0,u=e,i.label=1;case 1:return a<u.length?(s=u[a],c=s.attribute,l=s.select,f=c,l&&l.length>0?[4,t.getManyToOneMetadata(c,n,o)]:[3,7]):[3,9];case 2:h=i.sent(),d=h.ReferencedEntity,p=[],v=0,b=l,i.label=3;case 3:return v<b.length?(y=b[v],[4,t.getOptionsName(y,d,o)]):[3,6];case 4:g=i.sent(),p.push(g),i.label=5;case 5:return v++,[3,3];case 6:f+="($select="+p.join(",")+")",i.label=7;case 7:r.push(f),i.label=8;case 8:return a++,[3,1];case 9:return[2,r.length>0?"$expand="+r.join(","):null]}}))}))},t.generateOrderby=function(e,n,o){return void 0===e&&(e=[]),r(this,void 0,void 0,(function(){var r,a,u,s,c,l,f;return i(this,(function(i){switch(i.label){case 0:r=[],a=0,u=e,i.label=1;case 1:return a<u.length?(s=u[a],c=s.attribute,l=s.order,[4,t.getOptionsName(c,n,o)]):[3,4];case 2:f=i.sent(),r.push(f+" "+(l||"asc")),i.label=3;case 3:return a++,[3,1];case 4:return[2,r.length>0?"$orderby="+r.join(","):null]}}))}))},t.getOptionsName=function(e,n,o){return r(this,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return[4,t.isLookupAttribute(e,n,o)];case 1:return[2,r.sent()?"_"+e+"_value":e]}}))}))},t.isLookupAttribute=function(e,n,o){return r(this,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return[4,t.getManyToOneMetadata(e,n,o)];case 1:return[2,!!r.sent()]}}))}))},t.request=function(e,n,r,i){return void 0===i&&(i={}),new Promise((function(a,u){var s=t.getRequestOptions(e,n,i,r),c=o.request(s,(function(e){var n="";e.setEncoding("utf8"),e.on("data",(function(t){return n+=t})),e.on("end",(function(){try{a(t.handleNodeHttpsResponse(e,n))}catch(t){u(t)}}))}));c.on("error",(function(t){u(t)})),"GET"!==e&&c.write(r&&JSON.stringify(r)),c.end()}))},t.getRequestOptions=function(e,n,r,i){var o=n.split("/"),a=o[2],u="/"+o.slice(3,o.length).join("/"),s=Object.assign({},t.jsonHeaders,r);if("GET"!==e){var c=i&&JSON.stringify(i);s["Content-Length"]=c.length}return{hostname:a,port:443,path:encodeURI(u),method:e,headers:s}},t.handleNodeHttpsResponse=function(e,n){var r={200:function(){return t.dataHandler(e,n)},201:function(){return t.dataHandler(e,n)},204:function(){return{body:"",getResponseHeader:function(t){return e.headers[t]},statusCode:e.statusCode}}}[e.statusCode];if(r)return r();if(401===e.statusCode)throw new Error("Unauthorized");throw new Error(e.statusCode+": "+e.statusMessage+"\n "+n)},t.dataHandler=function(t,e){var n=null;try{n=JSON.parse(e)}catch(t){throw new Error("JSON response can't be parsed")}return{body:n,getResponseHeader:function(e){return t.headers[e]},statusCode:t.statusCode}},t.getEntityDefinition=function(e,n,o){return r(this,void 0,void 0,(function(){var r,a,u,s,c,l;return i(this,(function(i){switch(i.label){case 0:return r=n.settings,a=n.bearer,u=r.crm,s=u.url,c=u.version,l=s+"/api/data/v"+c+"/EntityDefinitions(LogicalName='"+e+"')",o&&(l+="?$select="+o.join(",")),[4,t.request("GET",l,null,{Authorization:"Bearer "+a})];case 1:return[2,i.sent().body]}}))}))},t.getManyToOneMetadata=function(e,n,o,a){return r(this,void 0,void 0,(function(){var r,u;return i(this,(function(i){switch(i.label){case 0:return[4,t.getManyToOneMetadatas(n,o)];case 1:return r=i.sent(),(u=r.find((function(t){return t.ReferencingEntityNavigationPropertyName===e})))||(u=r.find((function(t){var n=t.ReferencingAttribute,r=t.ReferencedEntity;return n===e&&(!a||a===r)}))),[2,u||null]}}))}))},t.getManyToOneMetadatas=function(e,n){return r(this,void 0,void 0,(function(){var r,o,a,u,s,c,l;return i(this,(function(i){switch(i.label){case 0:return r=n.settings,o=n.bearer,a=r.crm,u=a.url,s=a.version,c=u+"/api/data/v"+s+"/EntityDefinitions(LogicalName='"+e+"')/ManyToOneRelationships",[4,t.request("GET",c,null,{Authorization:"Bearer "+o})];case 1:return l=i.sent().body,[2,l.value]}}))}))},t.getAttributesMetadata=function(e,n,o){return r(this,void 0,void 0,(function(){var r,a,u,s,c,l,f;return i(this,(function(i){switch(i.label){case 0:return r=n.settings,a=n.bearer,u=r.crm,s=u.url,c=u.version,l=s+"/api/data/v"+c+"/EntityDefinitions(LogicalName='"+e+"')/Attributes?$filter=IsValidODataAttribute eq true",o&&(l+="&$select="+o.join(",")),[4,t.request("GET",l,null,{Authorization:"Bearer "+a})];case 1:return f=i.sent().body,[2,f.value]}}))}))},t.getAttributeMetadata=function(e,n,o,a){return r(this,void 0,void 0,(function(){var r,u,s,c,l,f;return i(this,(function(i){switch(i.label){case 0:return r=o.settings,u=o.bearer,s=r.crm,c=s.url,l=s.version,f=c+"/api/data/v"+l+"/EntityDefinitions(LogicalName='"+n+"')/Attributes(LogicalName='"+e+"')",a&&(f+="&$select="+a.join(",")),[4,t.request("GET",f,null,{Authorization:"Bearer "+u})];case 1:return[2,i.sent().body]}}))}))},t.jsonHeaders={"OData-MaxVersion":"4.0","OData-Version":"4.0",Accept:"application/json","Content-Type":"application/json; charset=utf-8"},t}();e.NodeApi=u},,,function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{s(r.next(t))}catch(t){o(t)}}function u(t){try{s(r.throw(t))}catch(t){o(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,u)}s((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}};Object.defineProperty(e,"__esModule",{value:!0});var o=n(6),a=n(7),u=n(0),s=function(){function t(){var e=this;this.sockets=[],this.context={log:function(t){return r(e,void 0,void 0,(function(){return i(this,(function(e){return[2,this.log(t)]}))}))},settings:JSON.parse(u.readFileSync(t.getCrmJsonPath(),"utf8"))},this.express=o(),this.express.use(o.static("node_modules/adal-angular/dist")),this.mountRoutes(),this.startListen()}return Object.defineProperty(t.prototype,"settings",{get:function(){return this.context.settings},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bearer",{get:function(){return this.context.bearer},set:function(t){this.context.bearer=t},enumerable:!0,configurable:!0}),t.prototype.startListen=function(){var t=this,e=this.settings.adal.redirectUri.split("/"),n=e[e.length-2].split(":"),r=parseInt(n[1]),i=e.slice(0,e.length-1).join("/");this.httpServer=this.express.listen(r,(function(){return a(i),console.log("server is listening on "+r)})),this.httpServer.on("connection",(function(e){t.sockets.push(e)}))},t.prototype.mountRoutes=function(){var e=o.Router();return t.mountDefaultRoute(e),this.mountAuthRoute(e),this.mountTokenRoute(e),this.mountAuthenticatedRoute(e),this.express.use("/",e),e},t.mountDefaultRoute=function(t){t.get("/",(function(t,e){e.redirect("/auth")}))},t.prototype.mountAuthRoute=function(t){var e=this;t.get("/auth",(function(t,n){n.send('\n                <head>\n                    <title>test</title>\n                </head>\n                <body>\n                    \x3c!--script src="adal.min.js"></script--\x3e\n                    <script src="https://secure.aadcdn.microsoftonline-p.com/lib/1.0.17/js/adal.min.js"><\/script>\n                    <script src="https://secure.aadcdn.microsoftonline-p.com/lib/1.0.17/js/adal-angular.min.js"><\/script>\n                    <script>\n                        var config = {\n                            clientId: "'+e.settings.adal.clientId+"\",\n                            popUp: true,\n                            callback: function (errorDesc, token, error, tokenType) {\n                                authContext.acquireToken('"+e.settings.crm.url+'\', function (errorDesc, token, error) {\n                                    if (!error) {\n                                        window.location.href = "/token/" + token;\n                                    }\n                                });\n                            }\n                        }\n                        if (this.settings.adal.tenant) {\n                            config.tenant = "'+e.settings.adal.tenant+'";\n                        }\n                        var authContext = new AuthenticationContext(config);\n                        if (authContext.isCallback(window.location.hash)) {\n                            authContext.handleWindowCallback(window.location.hash);\n                        } else {\n                            authContext.login();\n                        }\n                    <\/script>\n                </body>')}))},t.prototype.mountTokenRoute=function(t){var e=this;t.get("/token/:token",(function(t,n){e.bearer=t.params.token,n.redirect("/authenticated")}))},t.prototype.mountAuthenticatedRoute=function(t){var e=this;t.get("/authenticated",(function(t,n){return r(e,void 0,void 0,(function(){var t=this;return i(this,(function(e){switch(e.label){case 0:return n.setHeader("Connection","Transfer-Encoding"),n.setHeader("Content-Type","text/html; charset=utf-8"),n.setHeader("Transfer-Encoding","chunked"),n.flushHeaders(),this.response=n,[4,this.onAuthenticated()];case 1:return e.sent(),setTimeout((function(){t.httpServer.close((function(){return console.log("server stopped listening")}));for(var e=0,n=t.sockets;e<n.length;e++){n[e].destroy()}}),100),n.send(),[2]}}))}))}))},t.prototype.onAuthenticated=function(){return Promise.resolve()},t.prototype.log=function(t){var e=this;return new Promise((function(n){e.response.write(t+"<br/>",(function(){e.response.flushHeaders(),n()}))}))},t.getCrmJsonPath=function(){return u.existsSync("crm.json")?"crm.json":"../crm.json"},t}();e.AdalRouter=s},function(t,e){t.exports=require("https")},function(t,e){t.exports=require("express")},function(t,e){t.exports=require("open")},,,,,,,,,,,,,function(t,e,n){t.exports=n(21)},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{s(r.next(t))}catch(t){o(t)}}function u(t){try{s(r.throw(t))}catch(t){o(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,u)}s((r=r.apply(t,e||[])).next())}))},a=this&&this.__generator||function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}};Object.defineProperty(e,"__esModule",{value:!0});var u=n(4),s=n(22),c=n(23),l=n(24);new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.onAuthenticated=function(){var t=process.argv[3];return this.log("Customizable: "+t),this.setFormCustomizable("true"===t)},e.prototype.setFormCustomizable=function(t){return o(this,void 0,void 0,(function(){var e,n,r,i,o,u;return a(this,(function(a){switch(a.label){case 0:return this.log("Solution name: "+this.settings.crm.solution_name),[4,s.SolutionService.getSolution(["solutionid"],this.context)];case 1:return e=a.sent(),this.log("Solution id: "+e.solutionid),this.log(""),[4,this.getSolutionComponents(e)];case 2:n=a.sent(),r=0,i=n,a.label=3;case 3:return r<i.length?(o=i[r],this.log("SolutionComponent: "+o.objectid),[4,this.getSystemForm(o)]):[3,7];case 4:return u=a.sent(),[4,this.setForm(u,t)];case 5:a.sent(),a.label=6;case 6:return r++,[3,3];case 7:return[2]}}))}))},e.prototype.setForm=function(t,e){return o(this,void 0,void 0,(function(){var n;return a(this,(function(r){switch(r.label){case 0:if(this.log("Form name: "+t.name),t.iscustomizable.Value===e&&t.canbedeleted.Value===e)return[3,5];t.iscustomizable.CanBeChanged&&(t.iscustomizable.Value=e),t.canbedeleted.CanBeChanged&&(t.canbedeleted.Value=e),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,l.SystemFormService.updateRecord(t.formid,t,this.context)];case 2:return r.sent(),this.log("Updated"),[3,4];case 3:return n=r.sent(),this.log(n.message),[3,4];case 4:return[3,6];case 5:this.log("Unmodified"),r.label=6;case 6:return this.log("---------------------------"),[2]}}))}))},e.prototype.getSolutionComponents=function(t){return c.SolutionComponentService.retrieveMultipleRecords({select:["objectid"],filters:[{conditions:[{attribute:"solutionid",value:t.solutionid},{attribute:"componenttype",value:60}]}]},this.context)},e.prototype.getSystemForm=function(t){return l.SystemFormService.getSystemForm(t.objectid,["name","objecttypecode","iscustomizable","canbedeleted"],this.context)},e}(u.AdalRouter))},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{s(r.next(t))}catch(t){o(t)}}function u(t){try{s(r.throw(t))}catch(t){o(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,u)}s((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}};Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),a=function(){function t(){}return t.retrieveMultipleRecords=function(e,n){return r(this,void 0,void 0,(function(){return i(this,(function(r){return[2,o.NodeApi.retrieveMultipleRecords(t.logicalName,e,n)]}))}))},t.getSolution=function(e,n){return r(this,void 0,void 0,(function(){var r,o,a;return i(this,(function(i){switch(i.label){case 0:return r=n.settings,o=r.crm,a=o.solution_name,[4,t.retrieveMultipleRecords({select:e,filters:[{conditions:[{attribute:"uniquename",value:a}]}]},n)];case 1:return[2,i.sent()[0]]}}))}))},t.logicalName="solution",t}();e.SolutionService=a},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{s(r.next(t))}catch(t){o(t)}}function u(t){try{s(r.throw(t))}catch(t){o(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,u)}s((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}};Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),a=function(){function t(){}return t.retrieveMultipleRecords=function(e,n){return r(this,void 0,void 0,(function(){return i(this,(function(r){return[2,o.NodeApi.retrieveMultipleRecords(t.logicalName,e,n)]}))}))},t.logicalName="solutioncomponent",t}();e.SolutionComponentService=a},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{s(r.next(t))}catch(t){o(t)}}function u(t){try{s(r.throw(t))}catch(t){o(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,u)}s((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}};Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),a=function(){function t(){}return t.retrieveMultipleRecords=function(e,n){return r(this,void 0,void 0,(function(){return i(this,(function(r){return[2,o.NodeApi.retrieveMultipleRecords(t.logicalName,e,n)]}))}))},t.updateRecord=function(e,n,a){return r(this,void 0,void 0,(function(){return i(this,(function(r){return[2,o.NodeApi.updateRecord(t.logicalName,e,n,a)]}))}))},t.getSystemForm=function(e,n,o){return r(this,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return[4,t.retrieveMultipleRecords({select:n,filters:[{conditions:[{attribute:"formid",value:e}]}]},o)];case 1:return[2,r.sent()[0]]}}))}))},t.logicalName="systemform",t}();e.SystemFormService=a}]);